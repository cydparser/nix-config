#!/usr/bin/env bash

export NIXPKGS_LIST="$XDG_CACHE_HOME/nix/pkgs-list"

# https://nixos.org/channels/nixos-unstable
_=${NIX_CHANNEL_UNSTABLE:=nu}

if [[ -n "$DARWIN" ]] && [[ -z "$SHELL" ]]; then
  # Needed by exec-path-from-shell-initialize (emacs).
  SHELL="$(which zsh)" || SHELL="$(which bash)"
fi

nix-q() {
  [[ -f "$NIXPKGS_LIST" ]] || nix-update
  rg -i "$1" "$NIXPKGS_LIST"
}

nix-update() {
  mkdir -p "$(dirname "$NIXPKGS_LIST")"
  nix-channel --update && nix-env -qaP '*' > "$NIXPKGS_LIST" && \
    nix-env -qaP -A "$NIX_CHANNEL_UNSTABLE.haskellPackages" >> "$NIXPKGS_LIST"
}
}
