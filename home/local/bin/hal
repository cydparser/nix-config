#!/usr/bin/env bash
#
# Run Nix-style cabal-install commands by default.
set -e

case "$1" in
  bench|build|clean|configure|freeze|haddock|install|repl|run|test|update|exec)
    _cmd="v2-$1" ;;
  *)
    _cmd="$1" ;;
esac
shift

if [[ -z "$IN_NIX_SHELL" && -z "$DIRENV_DIR" && -f shell.nix ]]; then
  _args=''
  if [[ $# -gt 0 ]]; then
    _args="$(printf ' %q' "$@")"
  fi
  exec nix-shell --run "cabal $_cmd $_args"
else
  exec cabal "$_cmd" "$@"
fi
