#!/usr/bin/env bash
set -e

if [[ "${#}" -gt 0 ]]; then
  _ARGS=$(printf '%q ' "$@")
fi

_ORIG_PATH="$NIX_PATH"
NIX_PATH="$(nix-instantiate --eval --expr "<${NIX_CHANNEL_UNSTABLE:-nu}>")"

exec nix-shell -p nixUnstable \
     --run "export NIX_PATH=$_ORIG_PATH; nix $_ARGS"
